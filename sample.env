# --- Postgres (required for docker/m8flow-docker-compose.yml; m8flow-db needs non-empty POSTGRES_PASSWORD) ---
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=postgres

# --- Flask / Backend ---
FLASK_DEBUG=1
FLASK_ENV=development
FLASK_APP=app.py
# CHANGE this to your own random secret (32+ chars)
FLASK_SESSION_SECRET_KEY=123456789abcdef0123456789abcdef

M8FLOW_BACKEND_ENV=local_development
M8FLOW_BACKEND_LOG_LEVEL=INFO
WATCHFILES_FORCE_POLLING=true

# --- Database (SQLAlchemy URI) ---
M8FLOW_BACKEND_DATABASE_TYPE=postgres
M8FLOW_BACKEND_DATABASE_URI=postgresql://postgres:postgres@<LOCAL_IP>:1111/postgres
# M8FLOW migration on startup
M8FLOW_BACKEND_UPGRADE_DB=true
# Spiffworkflow migration on startup
M8FLOW_BACKEND_SW_UPGRADE_DB=true


# --- Ports / URLs (replace <LOCAL_IP> with your machine IP) ---
M8FLOW_BACKEND_PORT=8000
M8FLOW_BACKEND_URL=http://<LOCAL_IP>:8000
M8FLOW_BACKEND_URL_FOR_FRONTEND=http://<LOCAL_IP>:8001
# CORS: list frontend origins as host:port; include the port your frontend runs on (e.g. 8001 for Docker, 7001 for local).
M8FLOW_BACKEND_CORS_ALLOW_ORIGINS=localhost:8001,localhost:7001,localhost:5173,127.0.0.1:8001

# --- Models path inside container ---
M8FLOW_BACKEND_BPMN_SPEC_ABSOLUTE_DIR=./process_models
# --- Templates storage directory inside container ---
M8FLOW_TEMPLATES_STORAGE_DIR=./templates

# --- Auth (OIDC / Keycloak) ---
M8FLOW_BACKEND_OPEN_ID_SERVER_URL=http://<LOCAL_IP>:7002/realms/spiffworkflow
M8FLOW_BACKEND_OPEN_ID_CLIENT_ID=spiffworkflow-backend
M8FLOW_BACKEND_OPEN_ID_CLIENT_SECRET_KEY=
M8FLOW_BACKEND_OPEN_ID_IS_AUTHORITY_FOR_USER_GROUPS=true
KEYCLOAK_ENABLE_CLIENT_AUTH=false

# When using SPIFFWORKFLOW_BACKEND_AUTH_CONFIGS (e.g. Keycloak on 7002, realm spiffworkflow-local),
# set client_secret to match the client in Keycloak (see extensions/m8flow-backend/keycloak/realm_exports).
# Use identifier=spiffworkflow-local so it matches the frontend cookie (authentication_identifier).
# If you use identifier=default, the extension will still add an alias at startup so token decode works.
# SPIFFWORKFLOW_BACKEND_AUTH_CONFIGS__0__identifier=spiffworkflow-local
# SPIFFWORKFLOW_BACKEND_AUTH_CONFIGS__0__uri=http://localhost:7002/realms/spiffworkflow-local
# SPIFFWORKFLOW_BACKEND_AUTH_CONFIGS__0__client_id=spiffworkflow-backend
# SPIFFWORKFLOW_BACKEND_AUTH_CONFIGS__0__client_secret=JXeQExm0JhQPLumgHtIIqf52bDalHz0q
#
# For create-realm/create-tenant APIs to accept Keycloak master realm admin tokens, add an auth
# config with identifier "master" for the Keycloak master realm (same Keycloak URL, realm "master").
# Example (add as second entry or use __1__): identifier=master, uri=http://localhost:7002/realms/master,
# client_id=admin-cli (or your master realm client), client_secret as needed.

# --- Celery / Redis ---
M8FLOW_BACKEND_CELERY_ENABLED=false
M8FLOW_BACKEND_CELERY_BROKER_URL=redis://<LOCAL_IP>:6379/0
M8FLOW_BACKEND_CELERY_RESULT_BACKEND=redis://<LOCAL_IP>:6379/0
M8FLOW_BACKEND_RUNNING_IN_CELERY_WORKER=false

# --- Frontend ---
M8FLOW_BACKEND_URL_FRONTEND=http://<LOCAL_IP>:8000  
M8FLOW_BACKEND_URL=http://<LOCAL_IP>:8000          

# --- Connector proxy ---
M8FLOW_BACKEND_CONNECTOR_PROXY_URL=http://<LOCAL_IP>:7004

# --- Permissions ---
M8FLOW_BACKEND_PERMISSIONS_FILE_ABSOLUTE_PATH=./extensions/m8flow-backend/src/m8flow_backend/config/permissions/m8flow.yml
#M8FLOW_BACKEND_PERMISSIONS_FILE_NAME=m8flow.yml

# --- Extensions frontend: multitenant mode (tenant selection page as default) ---
# Single-tenant when false; multi-tenant when true (tenant selection, /tenants/check, etc.).
# When true, m8flow-frontend (extensions/m8flow-frontend) shows tenant selection at / and validates tenant via GET /tenants/check before login.
# The m8flow frontend start script passes MULTI_TENANT_ON to Vite; set when running m8flow frontend (e.g. MULTI_TENANT_ON=true npm start).
MULTI_TENANT_ON=false

# --- SQLAlchemy Logs---
M8FLOW_SQLALCHEMY_ECHO=false

# --- Encryption (for sensitive data at rest) ---
M8FLOW_BACKEND_ENCRYPTION_LIB=cryptography
M8FLOW_BACKEND_ENCRYPTION_KEY=0123456789abcdef0123456789abcdef

# --- Tenancy ---
# One Keycloak realm per tenant; realm name/slug identifies the tenant and is used in login URLs and JWT (m8flow_tenant_id).
M8FLOW_DEFAULT_TENANT_ID=default
M8FLOW_ALLOW_MISSING_TENANT_CONTEXT=true

# --- Keycloak ---
KEYCLOAK_ADMIN=admin
# Keycloak admin app (keycloak_admin_app/config.py): URL, realm, admin user, client credentials / mTLS
KEYCLOAK_URL=http://<LOCAL_IP>:7002
KEYCLOAK_REALM=tenant-a
KEYCLOAK_ADMIN_USER=admin
# Required for create-realm API: backend uses this to get a master-realm token and call Keycloak admin API.
# Use KEYCLOAK_ADMIN_PASSWORD or M8FLOW_KEYCLOAK_ADMIN_PASSWORD (same value).
KEYCLOAK_ADMIN_PASSWORD=admin
KEYCLOAK_CLIENT_ID=my-backend-app
KEYCLOAK_CLIENT_SECRET=
# mTLS (optional): paths to client cert and key for Keycloak admin API
# KEYCLOAK_CERT_FILE=
# KEYCLOAK_KEY_FILE=
KC_DB_URL=jdbc:postgresql://keycloak-db:5432/keycloak
KC_DB_USERNAME=keycloak
KC_DB_PASSWORD=keycloak
KC_HTTP_PORT=8080
KC_HOSTNAME_STRICT=false


# --- MinIO ---
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin